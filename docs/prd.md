# Focus Flow 产品需求文档 (PRD)

**项目名称：** Focus Flow
**文档版本：** 1.0
**最后更新：** 2025-11-19
**文档负责人：** PM John 📋

---

## 目标和背景

### 目标

Focus Flow 是一款面向个人用户的待办清单应用，旨在通过以下方式提升工作效率：

- **减少决策疲劳** - 让用户知道"此刻该做什么"而非"我有什么要做"
- **提升专注力** - 通过"当下能做什么"视图，帮助用户快速进入专注状态
- **动态优先级管理** - 使用时间敏感度标签（今天必须/本周内/随时可做）替代静态优先级
- **持续改进循环** - 通过每日总结和进度跟踪，帮助用户反思工作模式并优化
- **1周MVP交付** - 在严格的时间约束下，聚焦核心差异化功能

### 背景

传统待办清单应用让用户面对"一堆任务"，需要不断做选择，消耗专注力。优先级会随时间和情境变化（早上重要的事，下午可能就不重要了；在公司 vs 在家，优先级完全不同），而静态的"高中低"优先级标签无法应对这种动态性。

Focus Flow 颠倒了待办清单的时间视角：不展示"未来的待办列表"，而是聚焦于"此时此刻，基于当前时间/地点/状态，你能做什么"。这是一个核心的范式转变，将效率问题的本质——"认知负担"和"决策疲劳"——转化为产品设计优势。

**核心洞察：** 用户需要的不是更多功能，而是更少的选择。专注力是个人工作效率的核心。

### 变更日志

| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2025-11-19 | 1.0 | 初始PRD文档 | PM John |
| 2025-11-21 | 1.1 | 添加番茄工作法功能需求（V1.1 P0 优先级） | PM John |

---

## 需求

### 功能需求

**FR1:** 系统必须支持用户通过邮箱和密码进行注册和登录

**FR2:** 用户必须能够创建任务，每个任务包含：标题（必填）、描述（可选）、时间敏感度（今天必须/本周内/随时可做）、预估时长（可选，单位：分钟）

**FR3:** 用户必须能够编辑已创建的任务，修改任何字段（标题、描述、时间敏感度、预估时长）

**FR4:** 用户必须能够删除任务，删除前需要确认对话框

**FR5:** 用户必须能够标记任务为完成或取消完成，系统自动记录完成时间

**FR6:** 用户必须能够查看所有任务列表，任务按时间敏感度分组显示（今天必须/本周内/随时可做）

**FR7:** 系统必须提供"当下能做什么"视图，根据当前时间和任务时间敏感度，动态筛选并推荐最应该做的任务

**FR8:** "当下视图"必须支持单任务焦点模式，放大显示当前推荐任务，提供"完成"和"下一个"按钮

**FR9:** 完成任务后，系统必须自动推荐下一个任务（可在设置中关闭自动切换）

**FR10:** 系统必须自动追踪并生成每日总结，包含：完成任务数、创建任务数、总工作时长、完成率

**FR11:** 用户必须能够查看今日总结和历史总结（按日期选择），包括完成任务列表和统计数据

**FR12:** 系统必须提供过去7天/30天的任务完成趋势图（柱状图或折线图），可视化生产力模式

#### V1.1 功能需求（番茄工作法集成）

**FR13:** 用户必须能够在设置中启用/禁用番茄工作法功能（默认禁用）

**FR14:** 启用番茄工作法后，"专注当下"视图必须显示番茄计时器，包含以下功能：
- 可视化倒计时（MM:SS 格式）
- 开始/暂停/停止按钮
- 工作期（默认 25 分钟）和休息期（默认 5 分钟）状态区分
- 进度条显示当前番茄钟进度

**FR15:** 工作期结束时，系统必须显示友好提示对话框，提供 3 个选项：
- 开始休息（启动 5 分钟休息计时）
- 继续工作（开始新的 25 分钟工作期）
- 稍后决定（关闭对话框，计时器进入空闲状态）

**FR16:** 休息期结束时，系统必须显示提示对话框，提供 3 个选项：
- 开始工作（启动新的 25 分钟工作期）
- 再休息一会（延长休息 5 分钟）
- 暂停计时（停止计时器）

**FR17:** 系统必须自动记录每个完成的番茄钟到数据库，包含：
- 关联的任务 ID（如有）
- 会话类型（work/rest）
- 开始时间、结束时间、时长
- 是否完成整个番茄钟

**FR18:** 每日总结页面必须显示番茄钟统计：
- 今日完成的番茄钟数量
- 今日总专注时长（所有工作期时长之和）
- 按任务显示番茄钟分布（可选）

**FR19:** 用户必须能够在设置中配置番茄工作法参数：
- 工作时长（默认 25 分钟，可调整）
- 休息时长（默认 5 分钟，可调整）
- 是否启用提示音
- 工作期结束后是否自动开始休息

**FR20:** 番茄钟状态必须在页面刷新后保持（localStorage 持久化），如果用户刷新页面，正在进行的番茄钟应继续计时

### 非功能需求

**NFR1:** 系统必须在1周内完成MVP开发并可部署

**NFR2:** 前端页面的首次内容绘制（FCP）必须在2秒内完成（3G网络环境）

**NFR3:** "当下视图"页面的最大内容绘制（LCP）必须在2.5秒内完成

**NFR4:** 应用必须支持离线基本功能（PWA），任务数据缓存到IndexedDB，网络恢复后自动同步

**NFR5:** 代码必须通过ESLint和TypeScript类型检查，核心业务逻辑单元测试覆盖率≥80%

**NFR6:** 系统必须实现完整的测试金字塔：单元测试（Vitest）+ 集成测试（Supabase本地环境）+ E2E测试（Playwright）

**NFR7:** 所有用户界面必须符合WCAG AA无障碍标准（对比度4.5:1、键盘可访问、屏幕阅读器支持）

**NFR8:** 应用必须支持响应式设计，适配移动端（375px+）、平板（768px+）、桌面端（1280px+）

**NFR9:** 数据库必须使用Row Level Security (RLS)策略隔离用户数据，确保用户只能访问自己的任务

**NFR10:** 系统必须支持跨设备实时同步（Supabase Realtime），任务变更在3秒内同步到其他设备

---

## 用户界面设计目标

### 整体UX愿景

Focus Flow 的用户体验核心是**「专注当下」**的设计哲学。界面应该让用户在打开应用的瞬间就知道"现在该做什么"，而不是被一堆待办事项淹没。

**关键设计原则：**
- **极简主义** - 移除所有非必要元素，减少视觉噪音
- **单任务焦点** - 主屏幕突出显示"当前推荐任务"，而非完整列表
- **渐进式披露** - 需要时才展示完整任务列表和详情
- **平静的界面** - 使用柔和色彩，避免过度动效打断专注状态
- **即时反馈** - 任务完成时提供轻微的肯定感（微动效、音效可选）

### 关键交互范式

1. **"Now" 优先模式** - 默认展示"当下能做什么"视图，而非全部任务
2. **滑动完成** - 借鉴移动端手势：右滑完成任务，左滑延后
3. **快速添加** - 浮动按钮 + 全屏输入表单，减少步骤
4. **时间敏感度快速切换** - 通过颜色编码的芯片/标签快速识别（今天/本周/随时）
5. **"下一个"按钮** - 完成任务后自动推荐下一个，类似音乐播放器
6. **每日总结自动触发** - 晚上特定时间或完成最后一项任务时弹出反思提示

### 核心屏幕和视图

从产品视角看，以下是交付PRD价值所需的关键屏幕（按优先级排序）：

1. **登录/注册屏幕** - 邮箱密码认证
2. **"当下"主屏幕** (Current View) - MVP核心价值，展示当前推荐任务
3. **任务列表屏幕** - 查看所有任务（按时间敏感度分组）
4. **添加/编辑任务表单** - 快速创建和修改任务
5. **每日总结屏幕** - 展示当天完成情况和反思提示
6. **设置页面** - 账户管理、偏好设置（暗黑模式等）

### 无障碍性要求：WCAG AA

**选择理由：** WCAG AA 是2025年现代Web应用的基线标准，符合大多数法律合规要求且实现成本合理。

**关键要求：**
- 对比度至少4.5:1（常规文本）
- 键盘可访问性（全部功能可通过Tab和Enter操作）
- 屏幕阅读器支持（语义化HTML + ARIA标签）
- 焦点指示器清晰可见
- 表单输入错误提示清晰

### 品牌元素

**MVP阶段：极简现代风格，无特定品牌要求**

**色彩系统：**
- **主色调：** 深蓝色或深灰色（专业、专注）
- **强调色：** 温暖的绿色或橙色（完成任务时的积极反馈）
- **时间敏感度色彩编码：**
  - 今天必须：红色/橙色（紧迫感）
  - 本周内：黄色/琥珀色（中等优先级）
  - 随时可做：蓝色/灰色（低压力）

**字体：** 系统默认字体栈（-apple-system, Segoe UI, Roboto），确保跨平台一致性和加载速度

**图标：** Lucide Icons（开源、现代、一致性好）

### 目标设备和平台：Web响应式

**支持范围：**
- **桌面端：** 1280px+ 宽屏（主要工作场景）
- **平板：** 768px-1279px（iPad等，次要场景）
- **移动端：** 375px-767px（手机，重要但非主场景）

**响应式策略：**
- 移动端优先设计（Mobile-First CSS）
- 关键断点：375px (小屏手机)、768px (平板)、1024px (笔记本)、1280px (桌面)
- 移动端隐藏侧边栏，改用底部导航栏或汉堡菜单
- 桌面端使用固定侧边栏导航

**PWA能力：**
- 添加到主屏幕（移动端）
- 离线访问基础功能
- 推送通知（未来扩展：任务提醒）

---

## 技术假设

### 仓库结构：Monorepo

**决策：** 使用 **pnpm workspaces** 的 Monorepo 结构

**包组织：**
```
todo-list/
├── apps/
│   └── web/           # 前端应用 (Vite + React + TypeScript)
├── packages/
│   ├── shared/        # 共享类型定义 (TypeScript interfaces)
│   └── ui/            # 可复用UI组件（未来扩展）
└── supabase/          # 数据库迁移和配置
```

**选择理由：**
- MVP阶段只有单个前端应用，pnpm workspaces结构简单且无需额外工具
- 共享TypeScript类型确保前后端数据结构100%一致
- 为未来扩展预留空间（移动端App、浏览器插件等）
- pnpm比npm/yarn快3倍，节省磁盘空间

### 服务架构：BaaS模式（Backend-as-a-Service）

**决策：** 采用 **Supabase BaaS平台** + **React SPA** 的架构

**关键组件：**
- **前端：** React 18 单页应用（SPA），部署在Vercel Edge Network
- **后端：** Supabase Cloud提供PostgreSQL数据库、认证、实时订阅、RESTful API
- **数据层：** PostgreSQL 15+（Supabase托管），使用Row Level Security (RLS)保护用户数据
- **API层：** Supabase自动生成的REST API + Realtime WebSocket
- **认证层：** Supabase Auth（邮箱+密码登录，JWT tokens）

**选择理由（CRITICAL）：**
- **1周时间约束** - 不需要编写任何后端代码，专注前端体验
- **零运维成本** - Supabase处理数据库备份、扩展、安全更新
- **免费额度充足** - MVP阶段完全在免费tier内（500MB数据库，50GB带宽/月）
- **实时能力内置** - 跨设备同步，Supabase Realtime开箱即用
- **安全性强** - PostgreSQL RLS策略在数据库层面隔离用户数据

**架构模式：**
- Jamstack架构（静态站点 + 动态API）
- Local-First原则（PWA离线支持 + 云端同步）
- Optimistic UI更新（先更新UI，后台同步数据库）

### 测试要求：完整测试金字塔

**决策：** 实施 **单元测试 + 集成测试 + E2E测试**

**测试层级：**

1. **单元测试** - Vitest + Testing Library
   - 覆盖范围：工具函数、业务逻辑、React Hooks、Zustand stores
   - 目标覆盖率：核心业务逻辑 ≥ 80%

2. **集成测试** - Vitest + Supabase Test Helpers
   - 覆盖范围：API服务层与Supabase的集成
   - 测试环境：Supabase Local Development

3. **E2E测试** - Playwright
   - 覆盖范围：关键用户旅程（登录、创建任务、完成任务、查看总结）
   - 浏览器覆盖：Chrome、Firefox、Safari

**选择理由：**
- 质量保证，防止核心功能回归
- 自动化测试让重构更安全
- 测试即文档

### 其他技术假设和请求

**编程语言和框架：**
- 前端语言：TypeScript 5.3+（严格模式）
- 前端框架：React 18.2+（函数组件 + Hooks）
- 构建工具：Vite 5.0+
- UI组件库：shadcn/ui（基于Radix UI + Tailwind CSS）
- CSS方案：Tailwind CSS 3.4+
- 状态管理：Zustand 4.5+

**数据验证和工具库：**
- Schema验证：Zod 3.22+
- 日期处理：date-fns 3.0+
- 图标库：Lucide React

**部署和基础设施：**
- 前端托管：Vercel（Git集成CI/CD，全球CDN）
- 后端托管：Supabase Cloud（建议区域：新加坡或东京）
- CI/CD：GitHub Actions

**监控和错误追踪：**
- 性能监控：Vercel Analytics（Web Vitals）
- 错误追踪：Sentry Free Tier

**代码质量工具：**
- Linter：ESLint 8.5+
- Formatter：Prettier 3.1+
- Git Hooks：Husky + lint-staged

**安全性假设：**
- 认证方式：邮箱+密码（MVP），OAuth作为V2扩展
- 数据隔离：PostgreSQL RLS策略
- HTTPS：Vercel和Supabase强制HTTPS

---

## Epic列表

### Epic 1: 项目基础设施与用户认证
**目标：** 建立完整的项目骨架、开发环境、CI/CD流水线，并实现用户注册登录功能，确保后续开发在坚实的基础上进行。同时交付第一个可访问的页面（登录界面），验证整个技术栈的连通性。

### Epic 2: 核心任务管理（CRUD操作）
**目标：** 实现任务的完整生命周期管理，包括创建、查看、编辑、删除和完成任务。用户可以为每个任务设置时间敏感度标签（今天必须/本周内/随时可做）和预估时长，建立产品的基础数据模型和核心交互。

### Epic 3: "当下能做什么"视图（核心差异化功能）
**目标：** 实现Focus Flow的核心价值主张——动态展示"此刻应该做什么"，而非静态的待办列表。根据当前时间、任务的时间敏感度和用户状态，智能筛选并推荐当前最应该处理的任务，减少用户的决策疲劳，提升专注力。

### Epic 4: 每日总结与进度跟踪
**目标：** 提供自动化的每日任务完成总结和可视化进度展示，帮助用户回顾当天成果、反思工作模式，形成持续改进的正向循环。支持查看历史总结数据，跟踪长期生产力趋势。

---

## Epic 1: 项目基础设施与用户认证

**Epic目标：** 建立完整的项目骨架、开发环境、CI/CD流水线，并实现用户注册登录功能，确保后续开发在坚实的基础上进行。同时交付第一个可访问的页面（登录界面），验证整个技术栈的连通性。此Epic完成后，项目具备可部署的基础能力，所有核心开发工具和流程就位，团队可以高效地进行后续功能开发。

### Story 1.1: 初始化项目结构和开发环境

**作为** 开发者，
**我想要** 建立完整的Monorepo项目结构和开发工具链，
**以便** 团队可以在统一、高效的环境中开始开发工作。

**验收标准：**

1. 使用pnpm创建Monorepo结构，包含`apps/web`（Vite + React + TypeScript）和`packages/shared`（共享类型）
2. 配置TypeScript（tsconfig.json）启用严格模式，设置路径别名`@/*`指向`src/*`
3. 配置Vite（vite.config.ts）包含路径解析、React插件、Vitest测试环境
4. 配置Tailwind CSS和PostCSS，集成shadcn/ui主题变量
5. 配置ESLint（TypeScript + React规则）和Prettier，确保代码风格一致
6. 配置Husky + lint-staged实现提交前自动格式化和lint检查
7. 创建`.env.example`文件，说明所需的Supabase环境变量
8. 运行`pnpm install`成功安装所有依赖，`pnpm dev`可启动开发服务器
9. Git仓库初始化，创建`.gitignore`文件

### Story 1.2: 配置Supabase后端和数据库架构

**作为** 开发者，
**我想要** 建立Supabase项目和PostgreSQL数据库架构，
**以便** 应用可以存储用户数据和任务信息。

**验收标准：**

1. 在Supabase Cloud创建新项目（区域选择新加坡或东京），获取项目URL和Anon Key
2. 在本地安装Supabase CLI，运行`supabase init`初始化本地配置
3. 创建初始数据库迁移文件，包含tasks表和daily_summaries表
4. 为tasks表创建RLS策略，确保用户只能访问自己的任务
5. 为daily_summaries表创建RLS策略
6. 创建数据库触发器，自动更新updated_at字段
7. 运行`supabase db push`将迁移应用到Supabase Cloud
8. 在Supabase Studio中验证表结构和RLS策略
9. 使用Supabase CLI生成TypeScript类型定义

### Story 1.3: 实现Supabase客户端和错误处理基础设施

**作为** 开发者，
**我想要** 建立统一的Supabase客户端配置和错误处理机制，
**以便** 所有API调用都有一致的接口和可靠的错误处理。

**验收标准：**

1. 创建`src/lib/supabase.ts`，初始化Supabase客户端
2. 从环境变量读取配置，缺失则抛出清晰错误
3. 创建`src/types/models.ts`，定义Task和DailySummary接口
4. 创建`src/types/errors.ts`，定义自定义错误类
5. 创建`src/lib/errorHandler.ts`，实现统一错误处理
6. 创建`src/lib/utils.ts`，实现通用工具函数
7. 错误处理函数包含单元测试
8. 开发环境详细日志，生产环境脱敏

### Story 1.4: 实现用户注册功能

**作为** 新用户，
**我想要** 使用邮箱和密码注册账户，
**以便** 我可以开始使用Focus Flow管理我的任务。

**验收标准：**

1. 创建`src/pages/SignUpPage.tsx`，包含注册表单
2. 使用shadcn/ui Form组件实现表单验证（react-hook-form + Zod）
3. 创建`src/services/authService.ts`，实现signUp函数
4. 注册成功后跳转到登录页面，显示提示
5. 注册失败时显示友好错误信息
6. 表单提交时显示加载状态
7. 页面底部提供"已有账户？去登录"链接
8. 符合WCAG AA标准，响应式设计

### Story 1.5: 实现用户登录功能

**作为** 注册用户，
**我想要** 使用邮箱和密码登录系统，
**以便** 我可以访问我的任务数据。

**验收标准：**

1. 创建`src/pages/LoginPage.tsx`，包含登录表单
2. 使用shadcn/ui Form组件实现表单验证
3. 在authService中实现signIn函数
4. 登录成功后存储用户信息到Zustand store并跳转主页
5. 登录失败时显示友好错误信息
6. 表单提交时显示加载状态
7. 页面底部提供"没有账户？去注册"链接
8. 符合WCAG AA标准，响应式设计

### Story 1.6: 实现路由保护和认证状态管理

**作为** 系统，
**我想要** 确保未登录用户无法访问受保护的页面，
**以便** 保护用户数据安全并引导用户完成登录。

**验收标准：**

1. 创建`src/stores/authStore.ts`（Zustand），管理认证状态
2. 实现authStore的actions（setUser、clearUser、checkAuth）
3. 创建`src/components/features/auth/ProtectedRoute.tsx`组件
4. 在App.tsx中配置React Router路由（公开和受保护路由）
5. 应用启动时调用checkAuth恢复认证状态
6. 监听Supabase Auth状态变化，自动更新authStore
7. 实现退出登录功能
8. 路由切换时显示加载状态
9. 受保护路由未登录时重定向到登录页

### Story 1.7: 配置CI/CD流水线和自动化部署

**作为** 开发团队，
**我想要** 建立自动化的持续集成和部署流程，
**以便** 每次代码提交都自动运行测试和部署到生产环境。

**验收标准：**

1. 创建`.github/workflows/ci.yml`，配置GitHub Actions
2. 配置测试覆盖率报告
3. 在Vercel中连接GitHub仓库，配置自动部署
4. 在Vercel中配置环境变量
5. 配置Vercel构建命令和输出目录
6. 首次部署成功，可通过Vercel域名访问
7. 配置Vercel Analytics和错误追踪
8. 在README中添加CI/CD徽章和部署URL

### Story 1.8: 创建基础布局组件和应用外壳

**作为** 用户，
**我想要** 看到一致的应用布局（导航栏、侧边栏、主内容区），
**以便** 我可以直观地理解应用结构并快速导航。

**验收标准：**

1. 创建`src/components/layout/AppLayout.tsx`，实现应用主布局
2. 创建`src/components/layout/Sidebar.tsx`，包含导航链接
3. 创建`src/components/layout/Header.tsx`（移动端顶部栏）
4. 创建`src/components/layout/MobileNav.tsx`（移动端抽屉式导航）
5. 使用shadcn/ui的深色/浅色主题切换
6. 导航链接高亮当前页面
7. 布局在不同屏幕尺寸下正确显示
8. 所有交互元素符合WCAG AA标准
9. 创建占位主页，显示欢迎信息

---

## Epic 2: 核心任务管理（CRUD操作）

**Epic目标：** 实现任务的完整生命周期管理，包括创建、查看、编辑、删除和完成任务。用户可以为每个任务设置时间敏感度标签（今天必须/本周内/随时可做）和预估时长，建立产品的基础数据模型和核心交互。此Epic完成后，Focus Flow具备基本的待办清单功能，为后续的差异化特性提供数据基础。

### Story 2.1: 实现任务服务层（API封装）

**作为** 开发者，
**我想要** 创建统一的任务数据访问层，
**以便** 所有组件都通过一致的接口与Supabase交互。

**验收标准：**

1. 创建`src/services/taskService.ts`，实现getTasks、getTaskById、createTask、updateTask、deleteTask、completeTask函数
2. 使用Zod定义输入验证Schema
3. 所有函数使用统一错误处理
4. 函数自动过滤当前登录用户的任务（RLS）
5. getTasks默认按创建时间倒序排列
6. 为每个服务函数编写单元测试
7. 集成测试：使用Supabase本地环境验证实际CRUD操作

### Story 2.2: 创建任务状态管理Store

**作为** 开发者，
**我想要** 使用Zustand管理任务数据的全局状态，
**以便** 多个组件可以共享任务列表并实现Optimistic UI更新。

**验收标准：**

1. 创建`src/stores/taskStore.ts`（Zustand），包含tasks、isLoading、error状态
2. 实现actions：fetchTasks、addTask、updateTask、removeTask、setError
3. 实现Optimistic UI模式（立即更新本地state，失败时回滚）
4. 使用Zustand devtools中间件
5. 为store编写单元测试
6. 实现任务列表的派生状态（selectTodayTasks、selectThisWeekTasks等）

### Story 2.3: 创建任务卡片组件

**作为** 用户，
**我想要** 看到清晰的任务卡片展示任务信息，
**以便** 我可以快速浏览和识别任务。

**验收标准：**

1. 创建`src/components/features/tasks/TaskCard.tsx`，接收task作为props
2. 卡片显示：标题、描述、时间敏感度徽章、预估时长、完成状态
3. 卡片交互：点击编辑、右滑完成、长按显示菜单
4. 卡片样式：使用shadcn/ui Card，白色背景，圆角，阴影
5. 响应式设计
6. 可访问性：键盘Tab聚焦，Enter键触发编辑
7. 为TaskCard编写组件测试

### Story 2.4: 创建时间敏感度徽章组件

**作为** 用户，
**我想要** 通过颜色编码的徽章快速识别任务的时间敏感度，
**以便** 我可以优先处理紧急任务。

**验收标准：**

1. 创建`src/components/features/tasks/TimeSensitivityBadge.tsx`
2. 徽章显示文本和颜色：today（红色）、this_week（黄色）、anytime（蓝色）
3. 徽章样式：圆角胶囊形状，小字体
4. 可选compact模式：只显示颜色圆点
5. 符合WCAG AA对比度要求
6. 为组件编写测试

### Story 2.5: 实现创建任务功能

**作为** 用户，
**我想要** 通过简洁的表单快速创建新任务，
**以便** 我可以立即记录需要完成的事项。

**验收标准：**

1. 创建`src/components/features/tasks/TaskForm.tsx`，支持创建和编辑模式
2. 表单字段：标题（必填）、描述（可选）、时间敏感度（必选）、预估时长（可选）
3. 表单提交时验证、调用taskService.createTask、Optimistic更新
4. 创建`src/pages/TasksPage.tsx`，包含"新建任务"浮动按钮
5. 表单在移动端全屏，桌面端模态框
6. 键盘快捷键：Ctrl/Cmd + N打开创建表单
7. 符合WCAG AA标准
8. 为TaskForm编写E2E测试

### Story 2.6: 实现任务列表展示和筛选

**作为** 用户，
**我想要** 查看所有任务并按时间敏感度分组，
**以便** 我可以全面了解待办事项。

**验收标准：**

1. 创建`src/components/features/tasks/TaskList.tsx`，接收tasks作为props
2. 任务列表按时间敏感度分组显示
3. 每组显示任务数量统计
4. 空状态处理：显示友好提示和"创建第一个任务"按钮
5. 在TasksPage中使用TaskList组件
6. 实现下拉筛选器：全部/仅未完成/仅已完成
7. 实现任务搜索框（实时搜索，防抖300ms）
8. 列表性能优化：虚拟滚动处理大量任务
9. 响应式设计
10. 为TaskList编写单元测试

### Story 2.7: 实现编辑和删除任务功能

**作为** 用户，
**我想要** 修改已创建的任务或删除不再需要的任务，
**以便** 保持任务列表的准确性。

**验收标准：**

1. 点击TaskCard触发编辑：复用TaskForm组件，预填充数据
2. 删除功能：右键菜单显示删除，确认对话框，Optimistic删除
3. 提供"撤销"功能（3秒内可撤销）
4. 编辑和删除权限验证（RLS自动处理）
5. 键盘快捷键：E键编辑，Delete键删除
6. 编辑表单在移动端全屏，桌面端模态框
7. 为编辑和删除功能编写E2E测试

### Story 2.8: 实现完成任务功能和状态切换

**作为** 用户，
**我想要** 快速标记任务完成或取消完成，
**以便** 跟踪我的进度。

**验收标准：**

1. TaskCard显示完成状态切换按钮（桌面端复选框，移动端右滑）
2. 点击或滑动触发completeTask或更新is_completed
3. 完成任务时的交互反馈：动画、音效（可选）、Toast提示
4. 已完成的任务在列表底部显示或折叠区域
5. 可重新标记为未完成
6. 完成任务自动触发每日总结更新
7. 移动端滑动手势使用react-swipeable实现
8. 为完成/取消完成功能编写测试

---

## Epic 3: "当下能做什么"视图（核心差异化功能）

**Epic目标：** 实现Focus Flow的核心价值主张——动态展示"此刻应该做什么"，而非静态的待办列表。根据当前时间、任务的时间敏感度和用户状态，智能筛选并推荐当前最应该处理的任务，减少用户的决策疲劳，提升专注力。

### Story 3.1: 实现"当下任务"筛选逻辑

**作为** 开发者，
**我想要** 创建智能的任务筛选算法，
**以便** 系统可以根据当前情境推荐最应该做的任务。

**验收标准：**

1. 创建`src/lib/currentTaskFilter.ts`，实现getCurrentTasks函数
2. 筛选逻辑（优先级）：第一优先级"今天必须"、第二优先级"本周内"（周末时）、第三优先级"随时可做"（最多3个）
3. 额外筛选增强：考虑预估时长（晚上优先短任务）、考虑任务新鲜度（7天以上老任务提升优先级）
4. 返回任务列表按推荐优先级排序
5. 为筛选函数编写详细单元测试
6. 筛选逻辑可配置（为未来扩展预留）
7. 函数性能优化：支持1000+任务列表

### Story 3.2: 创建"当下视图"页面和布局

**作为** 用户，
**我想要** 打开应用时立即看到"当下应该做什么"，
**以便** 我可以快速进入专注状态。

**验收标准：**

1. 创建`src/pages/CurrentViewPage.tsx`，作为默认主页
2. 页面布局：顶部标题、中央单任务卡片、底部"下一个"按钮
3. 页面加载时获取任务并调用getCurrentTasks筛选
4. 背景颜色根据时间敏感度动态变化
5. 响应式设计
6. 页面动画：任务卡片淡入+缩放
7. 空状态处理：无任务时显示鼓励信息
8. 为CurrentViewPage编写E2E测试

### Story 3.3: 创建专注任务卡片组件

**作为** 用户，
**我想要** 看到放大的、信息丰富的任务卡片，
**以便** 我可以完全专注于当前任务。

**验收标准：**

1. 创建`src/components/features/current-view/FocusTaskCard.tsx`
2. 卡片样式：大号标题、完整描述、醒目徽章、预估时长、创建时间
3. 卡片交互按钮："完成任务"（主按钮）、"延后"、"编辑"
4. 卡片视觉：白色背景，大圆角，明显阴影
5. 完成任务时播放庆祝动画（五彩纸屑），自动切换下一个
6. "延后"功能：降低时间敏感度并切换下一个
7. 符合WCAG AA标准
8. 为FocusTaskCard编写组件测试

### Story 3.4: 实现"下一个任务"推荐和切换

**作为** 用户，
**我想要** 完成当前任务后自动看到下一个推荐任务，
**以便** 保持工作流的连续性。

**验收标准：**

1. 在CurrentViewPage中维护currentTaskIndex状态
2. 实现"下一个"按钮：currentTaskIndex + 1，滑动动画切换
3. 完成任务自动触发"下一个"（延迟1.5秒显示庆祝动画）
4. 到达列表末尾时显示"所有任务已处理完毕"空状态
5. 实现"上一个"按钮（可选）
6. 键盘快捷键：→或N键下一个，←或P键上一个，Space键完成
7. 切换动画流畅（60fps）
8. 为任务切换逻辑编写测试

### Story 3.5: 实现当前视图的实时更新和同步

**作为** 用户，
**我想要** 在其他设备修改任务后，当前视图自动更新，
**以便** 保持数据一致性。

**验收标准：**

1. 使用Supabase Realtime订阅tasks表变化
2. 实时更新逻辑：任务创建、更新、删除时重新筛选
3. 优化更新体验：本地操作立即更新，远程变化显示Toast通知
4. 处理网络中断：离线使用本地缓存，重新上线时同步
5. 性能优化：仅订阅当前用户任务，防抖更新（100ms）
6. 组件卸载时清理Realtime订阅
7. 为Realtime同步编写集成测试

### Story 3.6: 实现"当下视图"的个性化设置

**作为** 用户，
**我想要** 自定义"当下视图"的行为和展示，
**以便** 适应我的个人工作习惯。

**验收标准：**

1. 创建`src/pages/SettingsPage.tsx`，包含"当下视图设置"区块
2. 可配置选项：显示任务数量、自动切换、庆祝动画、音效、筛选偏好
3. 使用Zustand创建settingsStore，管理用户偏好
4. 设置页面使用shadcn/ui的Switch、RadioGroup、Checkbox组件
5. 设置实时生效
6. 偏好设置持久化到LocalStorage或Supabase
7. 提供"恢复默认设置"按钮
8. 符合WCAG AA标准
9. 为设置功能编写测试

### Story 3.7: 优化"当下视图"的性能和加载体验

**作为** 用户，
**我想要** 打开应用时快速看到当前任务，
**以便** 获得流畅的使用体验。

**验收标准：**

1. 实现骨架屏加载状态（Skeleton Loading）
2. 任务数据预加载：登录时后台预取任务列表
3. 代码分割和懒加载：非首屏组件使用React.lazy
4. 图片和资源优化：SVG格式，Tree-shakable图标
5. FCP优化：目标<1.5秒（3G网络）
6. 运行Lighthouse审计：Performance ≥ 90，FCP < 1.8s，LCP < 2.5s，CLS < 0.1
7. 使用React DevTools Profiler优化渲染
8. 在CI/CD中监控性能指标（Lighthouse CI）

---

## Epic 4: 每日总结与进度跟踪

**Epic目标：** 提供自动化的每日任务完成总结和可视化进度展示，帮助用户回顾当天成果、反思工作模式，形成持续改进的正向循环。支持查看历史总结数据，跟踪长期生产力趋势。

### Story 4.1: 实现每日总结数据自动生成

**作为** 系统，
**我想要** 自动追踪和汇总用户每天的任务完成情况，
**以便** 为用户提供准确的进度数据。

**验收标准：**

1. 在Supabase创建触发器，监听tasks表变化，自动更新daily_summaries
2. 创建`src/services/summaryService.ts`，实现getTodaySummary、getSummaryByDate、getRecentSummaries函数
3. 定义DailySummaryView类型（扩展DailySummary，包含completed_tasks数组）
4. 数据库触发器逻辑：使用PostgreSQL函数，确保事务一致性
5. 为summaryService编写单元测试
6. 为数据库触发器编写集成测试

### Story 4.2: 创建每日总结页面和统计展示

**作为** 用户，
**我想要** 查看今天的任务完成情况统计，
**以便** 了解我的工作成果和生产力水平。

**验收标准：**

1. 创建`src/pages/SummaryPage.tsx`，作为/summary路由
2. 页面布局：顶部日期选择器、中间统计卡片区域、底部完成任务列表和趋势图
3. 创建`src/components/features/summary/DailyStats.tsx`，显示已完成任务数、总工作时长、完成率、连续完成天数
4. 统计卡片设计：shadcn/ui Card，图标+数字+标签，响应式网格
5. 页面加载时从summaryService获取今日总结
6. 日期选择器：选择其他日期重新加载，禁用未来日期，快捷按钮（今天、昨天、本周）
7. 符合WCAG AA标准，响应式设计
8. 为DailyStats编写测试

### Story 4.3: 展示当天完成任务列表

**作为** 用户，
**我想要** 看到今天完成的所有任务详情，
**以便** 回顾具体成果，获得成就感。

**验收标准：**

1. 创建`src/components/features/summary/CompletedTasksList.tsx`
2. 列表展示：标题、描述、完成时间、时间敏感度徽章、预估时长
3. 列表按完成时间倒序排列
4. 任务项样式：勾选图标，灰色背景
5. 空状态处理：鼓励信息和"查看所有任务"链接
6. 列表交互：点击查看详情（只读），可选"取消完成"按钮
7. 响应式设计
8. 为CompletedTasksList编写测试

### Story 4.4: 实现进度趋势图可视化

**作为** 用户，
**我想要** 看到过去一周/一月的任务完成趋势图，
**以便** 识别我的生产力模式和改进方向。

**验收标准：**

1. 创建`src/components/features/summary/ProgressChart.tsx`，使用Recharts或Chart.js
2. 图表类型：柱状图或折线图，X轴日期，Y轴完成任务数
3. 图表数据：从getRecentSummaries获取最近7天数据
4. 图表交互：Hover显示详细数据，点击跳转到该日期总结
5. 时间范围切换：Tab选项卡"最近7天"、"最近30天"
6. 图表样式：主题色彩，响应式，暗黑模式支持
7. 性能优化：数据缓存，图表懒加载
8. 空状态处理：数据不足时显示提示
9. 为ProgressChart编写测试

### Story 4.5: 实现每日反思提示功能

**作为** 用户，
**我想要** 在每天结束时收到反思提示，
**以便** 回顾当天工作，思考改进方向。

**验收标准：**

1. 在SummaryPage添加"每日反思"区块（可折叠，默认展开）
2. 反思提示内容基于当天数据动态生成（完成率高/低的不同提示）
3. 提供反思问题引导（用户可选择回答）
4. 反思笔记功能：文本输入框，保存到daily_summaries.reflection_notes字段
5. 反思提示时机：晚上18:00后或完成最后任务时显示
6. 反思区块样式：温暖背景色，友好图标
7. 可关闭反思提示（用户偏好设置）
8. 为反思逻辑编写单元测试

### Story 4.6: 实现成就徽章系统（可选增强功能）

**作为** 用户，
**我想要** 通过完成任务解锁成就徽章，
**以便** 获得额外的激励和成就感。

**验收标准：**

1. 定义成就徽章列表（新手上路、连续3天、高效达人等）
2. 创建`src/components/features/summary/AchievementBadges.tsx`，显示已解锁徽章
3. 徽章解锁逻辑：任务完成时检查条件，首次解锁显示庆祝动画
4. 徽章展示：已解锁彩色，未解锁灰色轮廓+锁定图标
5. 徽章设计：Emoji或SVG图标，简洁名称和描述
6. 可选：徽章分享功能
7. 用户可在设置中关闭徽章功能
8. 为徽章系统编写单元测试

### Story 4.7: 优化总结页面的性能和数据导出

**作为** 用户，
**我想要** 快速加载历史总结数据并导出报告，
**以便** 高效查看和分享我的生产力记录。

**验收标准：**

1. 数据加载优化：分页/虚拟滚动，数据缓存（React Query或SWR），趋势图数据预加载
2. 导出功能：提供"导出CSV"按钮，下载当月或自定义时间范围的总结数据
3. 打印优化：优化打印样式，显示完整数据
4. 性能指标：LCP < 2.5s，趋势图渲染 < 500ms，大数据量无卡顿
5. 代码优化：React.memo优化图表，useMemo缓存计算结果
6. 数据同步优化：总结数据每小时同步，手动完成任务立即更新
7. 为导出功能编写E2E测试
8. 运行Lighthouse审计：Performance ≥ 85

---

## 检查清单结果报告

**PRD验证完成：** ✅ **READY FOR ARCHITECT**

**总体评分：** 92% 完整度
**MVP范围：** 恰到好处（Just Right）
**架构就绪度：** 准备就绪（Ready）

**详细检查清单报告见：** PM内部验证文档（已完成9个类别的系统化评估）

**关键发现：**
- ✅ 7个类别 PASS，2个类别 PARTIAL，0个 FAIL
- ✅ 无阻塞问题
- ⚠️ 3个HIGH优先级改进建议（成功指标、MVP验证计划、备份策略）
- ✅ Epic结构清晰，Story细化充分

**时间线评估：** 1周MVP可行但紧张，建议2人团队或延长至10天

---

## 下一步

### UX专家提示

你好！我是Focus Flow项目的UX专家。我需要基于已完成的PRD文档创建详细的用户体验设计。

**请查看以下文档：**
- `docs/prd.md` - 完整的产品需求文档
- `docs/brainstorming-session-results.md` - 产品创意头脑风暴结果

**我的任务是：**

为Focus Flow创建完整的UX设计方案，重点关注：

1. **核心创新体验** - "当下能做什么"视图的交互设计，如何让用户快速进入专注状态
2. **信息架构** - 从登录到任务完成到每日总结的完整用户旅程
3. **关键界面设计** - 6个核心屏幕的线框图和交互说明（登录、当下视图、任务列表、任务表单、每日总结、设置）
4. **响应式设计规范** - 移动端、平板、桌面端的适配策略
5. **无障碍性指南** - WCAG AA标准的具体实现建议
6. **微交互设计** - 任务完成庆祝动画、滑动手势、过渡效果

**设计约束：**
- 极简设计哲学（减少视觉噪音）
- 色彩编码时间敏感度（红/黄/蓝）
- 使用shadcn/ui组件库（基于Radix UI + Tailwind CSS）
- Web响应式优先，支持PWA

**交付物：**
- 完整的UX设计文档（Markdown格式）
- 核心界面线框图（可使用ASCII art或Mermaid描述）
- 交互流程图
- 组件规范说明

请开始创建UX设计方案。

---

### 架构师提示

你好！我是Focus Flow项目的架构师Winston。PRD已经完成并通过了PM检查清单验证（92%完整度，READY状态），现在需要基于PRD创建详细的技术架构设计。

**请查看以下文档：**
- `docs/prd.md` - 产品需求文档（包含技术假设和所有Epic/Story）
- `docs/architecture.md` - 已存在的初始架构文档

**注意：** 架构文档已经存在！你的任务是**审查并完善**现有架构，确保它完全支持PRD中定义的所有需求。

**我的任务是：**

1. **验证现有架构** - 检查`docs/architecture.md`是否覆盖PRD的所有需求
2. **补充缺失部分** - 特别是以下PRD中的新需求：
   - "当下任务"筛选算法的技术设计（Epic 3, Story 3.1）
   - Supabase Realtime的冲突解决策略（Epic 3, Story 3.5）
   - Optimistic UI的状态管理模式（Epic 2, Story 2.2）
   - 数据库触发器的性能优化（Epic 4, Story 4.1）
   - PWA离线数据同步机制（Epic 3, Story 3.5）
3. **细化实现细节** - 为30个User Story提供技术实现指导
4. **识别技术风险** - 根据PM检查清单标记的高复杂度区域，制定风险缓解方案

**关键技术约束（来自PRD）：**
- Monorepo（pnpm workspaces）
- BaaS架构（Supabase + Vercel）
- React 18 + TypeScript + Vite
- 完整测试金字塔（Vitest + Playwright）
- 1周MVP时间约束
- 性能目标：FCP < 1.5s，LCP < 2.5s

**PM检查清单标记的高风险技术领域：**
1. **Supabase Realtime冲突解决** - 多设备同时编辑同一任务的冲突处理
2. **Optimistic UI回滚逻辑** - 网络失败时UI状态回滚的用户体验
3. **数据库触发器性能** - 每次任务操作都触发daily_summaries更新的性能影响
4. **PWA离线支持的数据同步** - IndexedDB缓存 + Supabase同步的复杂性
5. **虚拟滚动实现** - 处理1000+任务列表的性能优化

**交付物：**
- 更新后的`docs/architecture.md`（如需修改）
- 关键技术决策文档（ADR - Architecture Decision Records）
- 数据流图和组件交互图
- 每个Epic的技术实现路线图

请开始审查现有架构并进行必要的补充和完善。

---

**PRD文档完成 ✅**

**文档版本：** v1.0
**最后更新：** 2025-11-19
**状态：** Ready for Architecture Phase
